# ğŸ“¡ Metaverse Game Server - í´ë¼ì´ì–¸íŠ¸ ì ‘ì† ê°€ì´ë“œ (í˜„í–‰í™” ì™„ë£Œ)

ì´ ë¬¸ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œ(í´ë¼ì´ì–¸íŠ¸) ê°œë°œìê°€ ì†Œì¼“ ì„œë²„ì— ì—°ê²°í•˜ê¸° ìœ„í•œ **ì‹¤ì œ êµ¬í˜„ ê¸°ì¤€** ì •ë³´ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤.  
í˜„ì¬ ì„œë²„ëŠ” **Oracle Cloud**ì— ë°°í¬ë˜ì–´ ìˆìœ¼ë©°, **HTTPS/WSS Secure Connection**ì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ“Œ 1. ì„œë²„ ì ‘ì† ì •ë³´ (Connection Info)

| êµ¬ë¶„ | ê°’ | ë¹„ê³  |
| :--- | :--- | :--- |
| **ì„œë²„ URL** | **`https://140.245.69.42.nip.io`** | **Port ë²ˆí˜¸ ì—†ìŒ** (443 ì‚¬ìš©) |
| **í”„ë¡œí† ì½œ** | `wss://` (HTTPS) | ì†Œì¼“ í†µì‹  ì‹œ ë³´ì•ˆ ì—°ê²° í•„ìˆ˜ |
| **Transports** | `["websocket"]` | í´ë§ ì—†ì´ ì¦‰ì‹œ ì›¹ì†Œì¼“ ì—°ê²° ê¶Œì¥ |

> **âš ï¸ ì£¼ì˜ì‚¬í•­**:  
> Vercel ë“± HTTPS í™˜ê²½ì—ì„œ ë°°í¬ëœ í´ë¼ì´ì–¸íŠ¸ëŠ” ë°˜ë“œì‹œ ìœ„ **HTTPS ì£¼ì†Œ**ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ’» 2. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì˜ˆì‹œ

```typescript
import { io } from "socket.io-client";

// ì„œë²„ ì£¼ì†Œ (HTTPS í•„ìˆ˜)
const SOCKET_URL = "https://140.245.69.42.nip.io";

export const socket = io(SOCKET_URL, {
  transports: ["websocket"], // ğŸš€ ì¤‘ìš”: ì›¹ì†Œì¼“ ì „ìš© ëª¨ë“œ
  secure: true,              // ğŸ”’ ì¤‘ìš”: SSL ì‚¬ìš© ëª…ì‹œ
  autoConnect: false         // ìˆ˜ë™ ì—°ê²° ì œì–´ (íƒ€ì´ë° ì´ìŠˆ ë°©ì§€)
});
```

---

## ğŸ“¡ 3. ì´ë²¤íŠ¸ ëª…ì„¸ (Socket Events)

**ì‹¤ì œ êµ¬ë™ ì¤‘ì¸ ì„œë²„ ì½”ë“œ(`index.ts`)** ê¸°ì¤€ì…ë‹ˆë‹¤.

### [Client -> Server] (ë³´ë‚´ëŠ” ë°ì´í„°)

| ì´ë²¤íŠ¸ëª… | ë°ì´í„° ì˜ˆì‹œ | ì„¤ëª… |
| :--- | :--- | :--- |
| **`join`** | `{ nickname: "Hero" }` | ë‹‰ë„¤ì„ê³¼ í•¨ê»˜ ê²Œì„ ì…ì¥ ìš”ì²­ |
| **`playerMove`** | `{ position: { x, y, z } }` | í”Œë ˆì´ì–´ ì´ë™ ì¢Œí‘œ ì „ì†¡ |
| **`chat`** | `{ message: "Hello!" }` | ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡ (ê°ì²´ í˜•íƒœ) |

### [Server -> Client] (ë°›ëŠ” ë°ì´í„°)

| ì´ë²¤íŠ¸ëª… | ë°ì´í„° íƒ€ì… | ì„¤ëª… |
| :--- | :--- | :--- |
| **`init`** | `{ id: "...", users: { ... } }` | ì ‘ì† ì§í›„(join ì „), í˜„ì¬ ì ‘ì† ì¤‘ì¸ ëª¨ë“  ìœ ì € ëª©ë¡ ìˆ˜ì‹  |
| **`playerJoined`** | `{ id, nickname, position }` | ìƒˆë¡œìš´ ìœ ì €ê°€ ë“¤ì–´ì™”ì„ ë•Œ ì•Œë¦¼ |
| **`playerMoved`** | `{ id, position: { x,y,z } }` | ë‹¤ë¥¸ ìœ ì €ê°€ ì›€ì§ì˜€ì„ ë•Œ ì¢Œí‘œ ìˆ˜ì‹  |
| **`playerLeft`** | `{ id }` | ë‹¤ë¥¸ ìœ ì €ê°€ ë‚˜ê°”ì„ ë•Œ ì•Œë¦¼ |
| **`chat`** | `{ id, sender, message, timestamp }` | ë‹¤ë¥¸ ìœ ì €(ë˜ëŠ” ë‚˜)ì˜ ì±„íŒ… ë©”ì‹œì§€ ìˆ˜ì‹  |

---

## ğŸ›  4. ì£¼ìš” ë¡œì§ ê°€ì´ë“œ (íƒ€ì´ë° ì´ìŠˆ í•´ê²°)

**ë¬¸ì œ ìƒí™©**: `socket.connect()` ì§í›„ ì„œë²„ê°€(`connection` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ) ì¦‰ì‹œ `init` ì´ë²¤íŠ¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ë¦¬ìŠ¤ë„ˆë¥¼ ëŠ¦ê²Œ ë“±ë¡í•˜ë©´ ì´ˆê¸° ìœ ì € ëª©ë¡ì„ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê¶Œì¥ êµ¬í˜„ ìˆœì„œ**:
1. `socket.on("init", ...)` ë“± **ë¦¬ìŠ¤ë„ˆë¥¼ ë¨¼ì € ë“±ë¡**í•©ë‹ˆë‹¤.
2. `socket.connect()`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
3. `connect` ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´(`socket.on("connect")`), ê·¸ë•Œ `socket.emit("join", ...)`ìœ¼ë¡œ ì…ì¥ì„ ì•Œë¦½ë‹ˆë‹¤.

```typescript
// ì˜ˆì‹œ: Hooks ë¡œì§
useEffect(() => {
    // 1. ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    socket.on("connect", () => {
        // 3. ì—°ê²° ì„±ê³µ í›„ ì…ì¥
        socket.emit("join", { nickname: "MyName" });
    });
    socket.on("init", (data) => { ... });

    // 2. ì—°ê²° ì‹œë„
    if (!socket.connected) socket.connect();
    
    // ... cleanup ...
}, []);
```
